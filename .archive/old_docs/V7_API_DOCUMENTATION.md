# V7 Ultimate API Documentation

**Version**: 1.0
**Last Updated**: 2025-11-19
**Base URL**: `http://178.156.136.185:5000`

---

## Table of Contents

1. [Overview](#overview)
2. [Authentication](#authentication)
3. [Signal Endpoints](#signal-endpoints)
4. [Statistics Endpoints](#statistics-endpoints)
5. [Performance Endpoints](#performance-endpoints)
6. [Cost Tracking Endpoints](#cost-tracking-endpoints)
7. [Theory Analysis Endpoints](#theory-analysis-endpoints)
8. [Response Formats](#response-formats)
9. [Error Codes](#error-codes)
10. [Rate Limits](#rate-limits)

---

## Overview

V7 Ultimate API provides access to trading signals generated by a mathematical framework combining 6 theories with DeepSeek LLM synthesis. All endpoints return JSON responses.

**Key Features**:
- Real-time trading signals (BUY/SELL/HOLD)
- Price predictions (Entry, Stop Loss, Take Profit)
- Mathematical theory analysis
- Cost tracking and budget monitoring
- Performance metrics and win/loss tracking

---

## Authentication

**Current Version**: No authentication required (local/internal use)

For production deployment with public access, consider adding:
- API key authentication
- JWT tokens
- Rate limiting per API key

---

## Signal Endpoints

### GET `/api/v7/signals/recent/<hours>`

Get recent V7 signals within specified time window.

**Parameters**:
- `hours` (path parameter): Integer, number of hours to look back (default: 24)

**Example Request**:
```bash
curl http://localhost:5000/api/v7/signals/recent/24
```

**Example Response**:
```json
[
  {
    "timestamp": "2025-11-19T12:05:35.135093",
    "symbol": "BTC-USD",
    "direction": "long",
    "confidence": 0.81,
    "tier": "high",
    "entry_price": 95250.0,
    "sl_price": 94500.0,
    "tp_price": 96800.0,
    "reasoning": "{\"theories\": {...}, \"reasoning\": \"Strong upward momentum...\"}",
    "model_version": "v7_ultimate"
  }
]
```

**Response Fields**:
- `timestamp`: ISO 8601 datetime (UTC)
- `symbol`: Trading pair (BTC-USD, ETH-USD, SOL-USD)
- `direction`: Signal type (`long` = BUY, `short` = SELL, `hold` = HOLD)
- `confidence`: Float 0-1 (model confidence)
- `tier`: String (`high` â‰¥75%, `medium` â‰¥65%, `low` <65%)
- `entry_price`: Recommended entry price (USD)
- `sl_price`: Stop loss price (USD)
- `tp_price`: Take profit price (USD)
- `reasoning`: JSON string with theory values and LLM reasoning

---

### POST `/api/v7/signals/<signal_id>/result`

Update signal result for manual trading tracking.

**Parameters**:
- `signal_id` (path parameter): Integer, ID of the signal to update

**Request Body**:
```json
{
  "result": "win",
  "exit_price": 96500.0,
  "pnl": 250.00,
  "notes": "Exited at resistance level"
}
```

**Body Fields**:
- `result` (required): String, one of: `"win"`, `"loss"`, `"pending"`, `"skipped"`
- `exit_price` (optional): Float, exit price in USD
- `pnl` (optional): Float, profit/loss amount in USD
- `notes` (optional): String, user notes

**Example Request**:
```bash
curl -X POST http://localhost:5000/api/v7/signals/774/result \
  -H "Content-Type: application/json" \
  -d '{
    "result": "win",
    "exit_price": 96500.0,
    "pnl": 250.00,
    "notes": "Hit TP target"
  }'
```

**Example Response**:
```json
{
  "success": true,
  "signal_id": 774,
  "result": "win",
  "message": "Signal 774 marked as win"
}
```

**Error Response** (404):
```json
{
  "error": "Signal not found"
}
```

**Error Response** (400):
```json
{
  "error": "Invalid result. Must be: win, loss, pending, or skipped"
}
```

---

### GET `/api/v7/signals/timeseries/<hours>`

Get time-series data for signal charting.

**Parameters**:
- `hours` (path parameter): Integer, hours to look back

**Example Request**:
```bash
curl http://localhost:5000/api/v7/signals/timeseries/24
```

**Example Response**:
```json
{
  "hours": 24,
  "total_signals": 138,
  "timeseries": [
    {
      "timestamp": "2025-11-19T08:00:00",
      "long_count": 0,
      "short_count": 1,
      "hold_count": 6,
      "total_count": 7,
      "avg_confidence": 0.58
    },
    {
      "timestamp": "2025-11-19T09:00:00",
      "long_count": 1,
      "short_count": 0,
      "hold_count": 5,
      "total_count": 6,
      "avg_confidence": 0.62
    }
  ]
}
```

**Usage**: Feed to Chart.js for signal timeline visualization

---

## Statistics Endpoints

### GET `/api/v7/statistics`

Get V7 runtime statistics.

**Example Request**:
```bash
curl http://localhost:5000/api/v7/statistics
```

**Example Response**:
```json
{
  "total_signals": 148,
  "avg_confidence": 0.598,
  "by_direction": {
    "long": 1,
    "short": 1,
    "hold": 146
  },
  "by_tier": {
    "high": 2,
    "medium": 10,
    "low": 136
  },
  "by_symbol": {
    "BTC-USD": 115,
    "ETH-USD": 20,
    "SOL-USD": 13
  },
  "latest_signal": {
    "timestamp": "2025-11-19T12:05:35",
    "symbol": "ETH-USD",
    "direction": "short",
    "confidence": 0.81,
    "tier": "high"
  },
  "total_cost": 0.0312
}
```

---

### GET `/api/v7/signals/confidence-distribution`

Get signal confidence distribution for histogram.

**Example Request**:
```bash
curl http://localhost:5000/api/v7/signals/confidence-distribution
```

**Example Response**:
```json
{
  "total_signals": 148,
  "bins": ["0%-50%", "50%-55%", "55%-60%", "60%-65%", "65%-70%", "70%-75%", "75%-80%"],
  "counts": [0, 20, 45, 58, 18, 5, 2],
  "avg_confidence": 0.598
}
```

---

## Performance Endpoints

### GET `/api/v7/performance`

Get win/loss performance metrics.

**Example Request**:
```bash
curl http://localhost:5000/api/v7/performance
```

**Example Response** (with tracked trades):
```json
{
  "total_trades": 25,
  "wins": 18,
  "losses": 7,
  "win_rate": 72.0,
  "total_pnl": 3250.00,
  "avg_pnl_per_trade": 130.00,
  "by_symbol": {
    "BTC-USD": {
      "wins": 10,
      "losses": 3,
      "pnl": 2100.00,
      "win_rate": 76.9,
      "count": 13
    },
    "ETH-USD": {
      "wins": 5,
      "losses": 2,
      "pnl": 850.00,
      "win_rate": 71.4,
      "count": 7
    }
  },
  "by_tier": {
    "high": {
      "wins": 8,
      "losses": 1,
      "pnl": 1800.00,
      "win_rate": 88.9,
      "count": 9
    },
    "medium": {
      "wins": 7,
      "losses": 3,
      "pnl": 1100.00,
      "win_rate": 70.0,
      "count": 10
    }
  },
  "by_direction": {
    "long": {
      "wins": 10,
      "losses": 4,
      "pnl": 1850.00,
      "win_rate": 71.4,
      "count": 14
    },
    "short": {
      "wins": 8,
      "losses": 3,
      "pnl": 1400.00,
      "win_rate": 72.7,
      "count": 11
    }
  }
}
```

**Example Response** (no trades tracked yet):
```json
{
  "total_trades": 0,
  "wins": 0,
  "losses": 0,
  "win_rate": 0.0,
  "total_pnl": 0.0,
  "avg_pnl_per_trade": 0.0,
  "by_symbol": {},
  "by_tier": {},
  "by_direction": {}
}
```

---

## Cost Tracking Endpoints

### GET `/api/v7/costs`

Get DeepSeek LLM API cost tracking.

**Example Request**:
```bash
curl http://localhost:5000/api/v7/costs
```

**Example Response**:
```json
{
  "total_cost": 0.031238,
  "total_signals": 148,
  "avg_cost_per_signal": 0.000211,
  "today": {
    "cost": 0.0193,
    "budget": 3.00,
    "percent_used": 0.64,
    "remaining": 2.98
  },
  "month": {
    "cost": 0.0312,
    "budget": 100.00,
    "percent_used": 0.03,
    "remaining": 99.97
  },
  "by_symbol": {
    "BTC-USD": {
      "cost": 0.0308,
      "count": 115
    },
    "ETH-USD": {
      "cost": 0.0004,
      "count": 2
    }
  },
  "daily_breakdown": [
    ["2025-11-18", 0.0118],
    ["2025-11-19", 0.0193]
  ],
  "monthly_breakdown": [
    ["2025-11", 0.0312]
  ]
}
```

**Budget Limits**:
- Daily: $3.00
- Monthly: $100.00

**Alert Thresholds**:
- ðŸŸ¢ Healthy: <80% used
- ðŸŸ¡ Warning: 80-95% used
- ðŸ”´ Critical: â‰¥95% used

---

## Theory Analysis Endpoints

### GET `/api/v7/theories/latest/<symbol>`

Get latest theory analysis for a symbol.

**Parameters**:
- `symbol` (path parameter): String, trading pair (e.g., "BTC-USD")

**Example Request**:
```bash
curl http://localhost:5000/api/v7/theories/latest/BTC-USD
```

**Example Response**:
```json
{
  "symbol": "BTC-USD",
  "timestamp": "2025-11-19T12:05:35",
  "signal": "long",
  "confidence": 0.81,
  "entry_price": 95250.0,
  "reasoning": "Strong upward momentum with low entropy...",
  "theories": {
    "shannon_entropy": 0.42,
    "hurst": 0.65,
    "kolmogorov": 0.38,
    "regime": "bullish",
    "risk_sharpe": 1.8,
    "fractal": 1.45
  },
  "llm_cost_usd": 0.0002,
  "input_tokens": 450,
  "output_tokens": 120,
  "generation_time_seconds": 1.2
}
```

**Theory Fields Explained**:
- `shannon_entropy`: 0-1, market randomness (lower = more predictable)
- `hurst`: 0-1, trend persistence (>0.5 = trending, <0.5 = mean-reverting)
- `kolmogorov`: 0-1, pattern complexity (lower = simpler patterns)
- `regime`: String, market state ("bullish", "bearish", "sideways")
- `risk_sharpe`: Float, risk-adjusted return ratio (>1 = good)
- `fractal`: Float, market structure dimension (1.5 = typical trending market)

---

### GET `/api/v7/theories/contribution`

Analyze which theories correlate with winning trades.

**Example Request**:
```bash
curl http://localhost:5000/api/v7/theories/contribution
```

**Example Response** (with tracked trades):
```json
{
  "total_analyzed": 25,
  "theory_stats": {
    "hurst": {
      "avg_when_win": 0.65,
      "avg_when_loss": 0.42,
      "difference": 0.23,
      "win_samples": 18,
      "loss_samples": 7,
      "total_samples": 25
    },
    "shannon_entropy": {
      "avg_when_win": 0.38,
      "avg_when_loss": 0.55,
      "difference": -0.17,
      "win_samples": 18,
      "loss_samples": 7,
      "total_samples": 25
    },
    "risk_sharpe": {
      "avg_when_win": 1.8,
      "avg_when_loss": 1.2,
      "difference": 0.6,
      "win_samples": 18,
      "loss_samples": 7,
      "total_samples": 25
    }
  },
  "interpretation": "Positive difference = theory value higher when winning"
}
```

**Interpretation**:
- **Positive difference**: Theory value was higher during winning trades
- **Negative difference**: Theory value was lower during winning trades
- **Larger absolute difference**: Theory has stronger predictive power

**Use Cases**:
1. Identify most predictive theories
2. Weight theories by contribution
3. Filter signals based on optimal theory ranges
4. Improve Bayesian learning priors

---

## Response Formats

### Success Response
All successful GET requests return HTTP 200 with JSON body.

### Error Response
Errors return appropriate HTTP status code with JSON body:

```json
{
  "error": "Error message description"
}
```

### Common HTTP Status Codes
- `200 OK`: Successful request
- `400 Bad Request`: Invalid parameters
- `404 Not Found`: Resource not found
- `500 Internal Server Error`: Server error

---

## Error Codes

| HTTP Code | Meaning | Example |
|-----------|---------|---------|
| 400 | Bad Request | Invalid result value in POST |
| 404 | Not Found | Signal ID doesn't exist |
| 500 | Server Error | Database connection failed |

---

## Rate Limits

**V7 Runtime Rate Limiting**:
- 6 signals per hour (10-minute minimum spacing)
- Prevents spam and controls costs
- Enforced at runtime level, not API level

**API Rate Limits**: Currently none (internal use)

For production:
- Recommended: 60 requests/minute per IP
- Use standard rate limiting headers

---

## Data Retention

- **Signals**: Stored indefinitely in SQLite database
- **Costs**: Extracted from signal notes, persistent
- **Performance**: Requires manual trade logging

---

## Webhook Support

**Status**: Not implemented

**Future Enhancement**: POST results to external URL when signal generated

---

## SDK / Client Libraries

**Status**: Not available

**Direct Integration**: Use standard HTTP libraries:

**Python**:
```python
import requests

# Get recent signals
response = requests.get('http://localhost:5000/api/v7/signals/recent/24')
signals = response.json()

# Log trade result
requests.post(
    'http://localhost:5000/api/v7/signals/774/result',
    json={'result': 'win', 'exit_price': 96500.0, 'pnl': 250.00}
)
```

**JavaScript**:
```javascript
// Get recent signals
const response = await fetch('http://localhost:5000/api/v7/signals/recent/24');
const signals = await response.json();

// Log trade result
await fetch('http://localhost:5000/api/v7/signals/774/result', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    result: 'win',
    exit_price: 96500.0,
    pnl: 250.00
  })
});
```

---

## Support & Contact

**Issues**: Report at https://github.com/your-org/crpbot/issues
**Documentation**: See V7_MONITORING.md for runtime management
**Dashboard**: http://178.156.136.185:5000

---

**Version History**:
- v1.0 (2025-11-19): Initial API documentation
