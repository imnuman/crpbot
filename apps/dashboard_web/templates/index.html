<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HYDRA 4.0 - Multi-Agent Trading System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            background: linear-gradient(90deg, #00ff88 0%, #00d4ff 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header h1 { font-size: 3em; font-weight: 800; }
        .header p { color: #888; font-size: 1.2em; }

        .grid { display: grid; gap: 20px; margin-bottom: 20px; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }

        .card {
            background: rgba(30, 30, 50, 0.8);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        .card h2 {
            font-size: 1.2em;
            color: #00ff88;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
        }
        .stat-value { font-size: 2.5em; font-weight: 700; color: #00ff88; }
        .stat-label { color: #888; font-size: 0.9em; margin-top: 5px; }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .price-row:last-child { border-bottom: none; }
        .price-symbol { font-weight: 600; color: #fff; }
        .price-value { font-size: 1.1em; }
        .price-change { font-size: 0.9em; padding: 4px 8px; border-radius: 4px; }
        .price-change.up { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .price-change.down { background: rgba(255, 68, 68, 0.2); color: #ff4444; }

        .gladiator-row {
            display: grid;
            grid-template-columns: 50px 1fr 80px 80px 80px;
            gap: 10px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            align-items: center;
        }
        .gladiator-row:last-child { border-bottom: none; }
        .gladiator-badge {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700;
        }
        .gladiator-a { background: linear-gradient(135deg, #4158D0, #C850C0); }
        .gladiator-b { background: linear-gradient(135deg, #0093E9, #80D0C7); }
        .gladiator-c { background: linear-gradient(135deg, #8EC5FC, #E0C3FC); }
        .gladiator-d { background: linear-gradient(135deg, #FBAB7E, #F7CE68); }
        .gladiator-name { font-weight: 600; }
        .gladiator-ai { color: #888; font-size: 0.85em; }
        .gladiator-elo { color: #00ff88; font-weight: 600; }
        .gladiator-stat { text-align: center; }

        .signal-row {
            display: grid;
            grid-template-columns: 140px 100px 80px 80px 1fr;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9em;
        }
        .signal-row:last-child { border-bottom: none; }
        .signal-direction {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            text-align: center;
        }
        .signal-long { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .signal-short { background: rgba(255, 68, 68, 0.2); color: #ff4444; }
        .signal-hold { background: rgba(255, 193, 7, 0.2); color: #ffc107; }

        .trade-row {
            display: grid;
            grid-template-columns: 100px 80px 80px 100px;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .trade-win { color: #00ff88; }
        .trade-loss { color: #ff4444; }

        .loading { color: #888; text-align: center; padding: 40px; }
        .error { color: #ff4444; }

        .refresh-info {
            text-align: center;
            color: #666;
            font-size: 0.8em;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>HYDRA 4.0</h1>
        <p>Multi-Agent Trading System</p>
    </div>

    <!-- Stats Overview -->
    <div class="grid grid-4" id="stats-grid">
        <div class="card stat-box">
            <div class="stat-value" id="stat-signals">-</div>
            <div class="stat-label">Total Signals</div>
        </div>
        <div class="card stat-box">
            <div class="stat-value" id="stat-trades">-</div>
            <div class="stat-label">Paper Trades</div>
        </div>
        <div class="card stat-box">
            <div class="stat-value" id="stat-winrate">-</div>
            <div class="stat-label">Win Rate</div>
        </div>
        <div class="card stat-box">
            <div class="stat-value" id="stat-pnl">-</div>
            <div class="stat-label">Total P&L</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="grid grid-2">
        <!-- Live Prices -->
        <div class="card">
            <h2>Live Prices</h2>
            <div id="prices-list">
                <div class="loading">Loading prices...</div>
            </div>
        </div>

        <!-- Tournament Leaderboard -->
        <div class="card">
            <h2>AI Tournament Leaderboard</h2>
            <div id="tournament-list">
                <div class="loading">Loading tournament data...</div>
            </div>
        </div>

        <!-- Recent Signals -->
        <div class="card">
            <h2>Recent Signals</h2>
            <div id="signals-list">
                <div class="loading">Loading signals...</div>
            </div>
        </div>

        <!-- Paper Trades -->
        <div class="card">
            <h2>Paper Trade Results</h2>
            <div id="trades-list">
                <div class="loading">Loading trades...</div>
            </div>
        </div>
    </div>

    <div class="refresh-info">
        Auto-refresh every 5 seconds | Last update: <span id="last-update">-</span>
    </div>

    <script>
        function formatPrice(price) {
            if (price >= 1000) return price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            if (price >= 1) return price.toFixed(4);
            return price.toFixed(6);
        }

        function formatTime(timestamp) {
            if (!timestamp) return '-';
            const d = new Date(timestamp);
            return d.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
        }

        async function fetchData(endpoint) {
            try {
                const response = await fetch(`/api/${endpoint}`);
                return await response.json();
            } catch (e) {
                console.error(`Error fetching ${endpoint}:`, e);
                return null;
            }
        }

        async function updatePrices() {
            const prices = await fetchData('prices');
            if (!prices) return;

            const html = Object.entries(prices).map(([symbol, data]) => `
                <div class="price-row">
                    <span class="price-symbol">${symbol.replace('-USD', '')}</span>
                    <span class="price-value">$${formatPrice(data.price)}</span>
                    <span class="price-change ${data.change >= 0 ? 'up' : 'down'}">
                        ${data.change >= 0 ? '+' : ''}${data.change.toFixed(2)}%
                    </span>
                </div>
            `).join('');

            document.getElementById('prices-list').innerHTML = html || '<div class="loading">No price data</div>';
        }

        async function updateTournament() {
            const data = await fetchData('tournament');
            if (!data || !data.length) return;

            const gladiatorColors = {A: 'a', B: 'b', C: 'c', D: 'd'};
            const html = data.map((g, i) => `
                <div class="gladiator-row">
                    <div class="gladiator-badge gladiator-${gladiatorColors[g.gladiator] || 'a'}">${i + 1}</div>
                    <div>
                        <div class="gladiator-name">Gladiator ${g.gladiator}</div>
                        <div class="gladiator-ai">${g.name}</div>
                    </div>
                    <div class="gladiator-elo">${g.elo}</div>
                    <div class="gladiator-stat">${g.wins}W/${g.losses}L</div>
                    <div class="gladiator-stat">${g.win_rate.toFixed(1)}%</div>
                </div>
            `).join('');

            document.getElementById('tournament-list').innerHTML = html;
        }

        async function updateSignals() {
            const signals = await fetchData('signals');
            if (!signals || !signals.length) {
                document.getElementById('signals-list').innerHTML = '<div class="loading">No signals yet</div>';
                return;
            }

            const html = signals.slice(0, 10).map(s => `
                <div class="signal-row">
                    <span>${formatTime(s.timestamp)}</span>
                    <span>${s.symbol.replace('-USD', '')}</span>
                    <span class="signal-direction signal-${s.direction.toLowerCase()}">${s.direction}</span>
                    <span>${(s.confidence * 100).toFixed(0)}%</span>
                    <span>$${formatPrice(s.entry_price || 0)}</span>
                </div>
            `).join('');

            document.getElementById('signals-list').innerHTML = html;
        }

        async function updateTrades() {
            const trades = await fetchData('trades');
            if (!trades || !trades.length) {
                document.getElementById('trades-list').innerHTML = '<div class="loading">No paper trades yet</div>';
                return;
            }

            const html = trades.slice(0, 10).map(t => `
                <div class="trade-row">
                    <span>${t.symbol.replace('-USD', '')}</span>
                    <span class="signal-direction signal-${t.direction.toLowerCase()}">${t.direction}</span>
                    <span class="${t.outcome === 'win' ? 'trade-win' : 'trade-loss'}">${t.outcome.toUpperCase()}</span>
                    <span class="${t.pnl_percent >= 0 ? 'trade-win' : 'trade-loss'}">
                        ${t.pnl_percent >= 0 ? '+' : ''}${t.pnl_percent.toFixed(2)}%
                    </span>
                </div>
            `).join('');

            document.getElementById('trades-list').innerHTML = html;
        }

        async function updateStats() {
            const stats = await fetchData('stats');
            if (!stats) return;

            document.getElementById('stat-signals').textContent = stats.total_signals.toLocaleString();
            document.getElementById('stat-trades').textContent = stats.total_trades.toLocaleString();
            document.getElementById('stat-winrate').textContent = stats.win_rate + '%';
            document.getElementById('stat-pnl').textContent = (stats.total_pnl >= 0 ? '+' : '') + stats.total_pnl + '%';
            document.getElementById('stat-pnl').style.color = stats.total_pnl >= 0 ? '#00ff88' : '#ff4444';
        }

        async function refreshAll() {
            await Promise.all([
                updatePrices(),
                updateTournament(),
                updateSignals(),
                updateTrades(),
                updateStats()
            ]);
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        }

        // Initial load and auto-refresh
        refreshAll();
        setInterval(refreshAll, 5000);
    </script>
</body>
</html>
